<project name="Logger Library" default="logger-library" basedir="." >

	<property name="FLEX_HOME" value="/opt/flex_3.5_sdk"/>
	<property name="SRC_DIR" value="${basedir}/src"/>
	<property name="DEPLOY_DIR" value="${basedir}/deploy"/>
	<property name="ASDOC_DIR" value="${basedir}/docs"/>
	<property name="OUTPUT_SWC" value="${DEPLOY_DIR}/logger.swc"/>
	<property name="DEBUG" value="true" />
   
	<taskdef resource="flexTasks.tasks"
			classpath="${FLEX_HOME}/ant/lib/flexTasks.jar" />
	
	<target name="all" depends="logger-library,docs" />
	
	<target name="logger-library" depends="clean">
		<!-- create the build directory -->
		<mkdir dir="${DEPLOY_DIR}"/>
		
		<property name="config" value="${DEPLOY_DIR}/config.xml" />
				
		<!-- Generate the config file. -->
		<xslt in=".flexLibProperties" out="${config}" style="config.xsl" />
		
		<compc 
			output="${OUTPUT_SWC}"
			allow-source-path-overlap="true"
			headless-server="true"
			warn-no-constructor="false"
			debug="${DEBUG}" 
			verbose-stacktraces="${DEBUG}">

			<define name="CONFIG::debug" value="${DEBUG}" />
			
			<!-- config file.generated by xslt -->
			<load-config filename="${config}" />
			
			<source-path path-element="${SRC_DIR}" />
			
			<external-library-path dir="${FLEX_HOME}/frameworks/libs" append="true">
				<include name="**/*.swc" />
			</external-library-path>
		</compc>
		
		<!-- clean up -->
		<delete file="${config}" />
	</target>
   
	<target name="clean">
		<delete dir="${DEPLOY_DIR}"/>
		<delete dir="${ASDOC_DIR}"/>
	</target>
	
	<target name="docs"> 
		<exec executable="${FLEX_HOME}/bin/asdoc" failonerror="true">
			<arg line="-source-path '${SRC_DIR}'" />
			<arg line="-doc-sources '${SRC_DIR}'" />
			<arg line="-main-title 'Logger Documentation'" />
			<arg line="-window-title 'Logger Documentation'" />
			<arg line="-output '${ASDOC_DIR}'" />
		</exec>
	</target>

</project>
